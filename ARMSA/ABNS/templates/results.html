{% extends "base.html" %}
{% load filterfortree %}
{% block content %}
<div id="leftmenu">
<ol>
    {% for street in streets %}
        <li>
        <label for={{ street.short_name }}>{{ street.long_name }}</label>
        <input type="checkbox" id={{ street.short_name }}>
        <ol id={{ street.short_name }}>
            {% for houses in clients_query|filter_house:street.short_name %}
            <li class="file"><a href="." rel="ids" id={{ houses.house }}>{{ houses.house }}</a></li>
            {% endfor %}
        </ol>
        </li>
    {% endfor %}
</ol>
</div>

<div id="uppermenu">
<table>
    <tr>
        <td><a href>Пользователи</a></td>
        <td><a href>Порты</a></td>
        <td><a href>VPN</a></td>
        <td><a href>Ограничения</a></td>
        <td><a href>Коммутаторы</a></td>
        <td><a href>Безопасность</a></td>
        <td><a href>МАС</a></td>
    </tr>
</table>
</div>

<div id="content">
<table class="users-table" id="#usertable">
        <tr>
                <td>Квартал</td>
                <td>Дом</td>
                <td>Кв</td>
                <td>Договор</td>
                <td>IP</td>
                <td>Основной IP</td>
                <td></td>
                <td></td>
                <td></td>
                <td>Блок</td>
                <td>Актив</td>
        </tr>
{% for entry in results_query %}
        <tr class="table-row">
                {% with template="//127.0.0.1:8000/ABNS/clients/"|add:entry.street|add:"/"|add:entry.house|add:"/" %}
                {% with n=entry.street|add:"-"|add:entry.house|add:"-"|add:entry.flat %}
                <form action={{ template }} method="post" name={{ n }}>
                {% endwith %}
                {% endwith %}
                {% csrf_token %}
                <input type="hidden" name="id" value={{ entry.id }}>
                {% include "streetsfield.html" %}
                {% include "userrowfield.html" %}
                <td width="5%"><a href="." class="service-button" rel="srv">Сервис</a></td>
                {% with r=forloop.counter0|stringformat:"d" %}
                <td width="5%"><a href="." class="change-button" name={{ r }} rel="chg">Изменить</a></td>
                {% endwith %}
                
                <td width="5%"><a href="." class="delete-button" rel="del">Удалить</a></td>
                {% if entry.active_state %}
                <td width="5%">
                <label id="yeslbl"><input type="checkbox" class="checkbox" value="1" name="1" checked="checked" />YES</label>
                </div>
                </td>
                {% else %}
                <td width="5%">
                <label id="nolbl"><input type="checkbox" class="checkbox" value="1" name="1"/>NO</label>
                </div>
                </td>
                {% endif %}

                {% if entry.lock_state %}
                <td width="5%">
                <label id="yeslbl"><input type="checkbox" class="checkbox" value="1" name="1" checked="checked" />YES</label>
                </div>
                </td>
                {% else %}
                <td width="5%">
                <label id="nolbl"><input type="checkbox" class="checkbox" value="1" name="1"/>NO</label>
                </div>
                </td>
                {% endif %}
                <td>port</td>
                </form>
        </tr>
{% endfor %}
</table>
</div>

{% endblock %}

{% block javascript %}

    <script language="javascript" type="text/javascript">
    $("a[rel^='ids']").click(function (event) {
        event.preventDefault();
        var host=$(location).attr('host');
        console.log(host);
        var ho=$(this).attr('id');
        var st=$(this).parent().parent().attr('id');
        console.log(host+"/clients/"+st+"/"+ho+"/");
        var path="//127.0.0.1:8000/clients/"+st+"/"+ho+"/";
        $(location).attr('href',"//127.0.0.1:8000/ABNS/clients/"+st+"/"+ho+"/");
        $("#content").load(path);
    });
    </script>

    <script language="javascript" type="text/javascript">
    $("a[rel^='srv']").click(function () {
        console.log("service");
    });
    </script>

    <script language="javascript" type="text/javascript">
    $("a[rel^='chg']").click(function (event) {
        event.preventDefault();
        var n = $(this).parents().find("form").eq(parseInt($(this).attr("name"))).attr("name");
        console.log($(this).parents().find("form").eq(parseInt($(this).attr("name"))).serialize());
        var action = confirm('Вы уверены, что желаете внести изменения в данные клиента '+n+'?');
        if(action){
            $(this).parents().find("form").eq(parseInt($(this).attr("name"))).submit();
        }
    });
    </script>
{% endblock %}
